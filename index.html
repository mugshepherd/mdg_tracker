<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style>
		svg {
			border-style: solid;
			border-width: 1px;
			border-color: #ccc;
		}
		.admin0_poly{
			fill:  #ddd;
		}
		.admin1_poly{
			/*fill: #ccc;*/
			fill: none;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-width: 1px;
			/*stroke-opacity: .8;*/
		}
		.admin2_poly{
			fill: none;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-width: 0.5px;
		}

		.admin1_labels {
			fill: #777;
			fill-opacity: .5;
			font-size: 20px;
			font-weight: 300;
			text-anchor: middle;
		}
		.cities_points {
			fill: red;
		}			
		.cities_label {
			font-family: Helvetica;
			font-weight: 300;
			font-size: 14px;
		}
		text {
		  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
		  font-size: 10px;
		  pointer-events: none;
		}
	</style>
</head>
<body>

<div id="map"></div>

<script>
(function(){
	var height = 900;
	var width = 600;
	var admin1 = void 0;
	var admin2 = void 0;

	var geoID = function(d) {
		return "c" + d.properties.ID_2;
	};
	var click = function(d) {
		admin2.attr('fill-opacity', 0.2);
		d3.select('#' + geoID(d)).attr('fill-opacity', 1)
	};

	var projection = d3.geo.mercator();
	var path = d3.geo.path().projection(projection);
	var svg = d3.select("#map")
		.append("svg")
		.attr("width", width)
		.attr("height", height)

	d3.json('mdg-output.json', function(error, data){
		if (error) return console.error(error);
		var country = topojson.feature(data, data.objects.mdg_adm0);
		var provinces = topojson.feature(data, data.objects.mdg_adm1);
		var regions = topojson.feature(data, data.objects.mdg_adm2);
		var populatedPlaces = topojson.feature(data, data.objects.mdg_places)		
		//country map:
		var admin0_map = svg.append('g');		
		var admin2_map = svg.append('g').attr('class', 'admin2_poly');
		var admin1_map = svg.append('g');
		//Cities
		var cityPoints = svg.append('g').attr('class', 'cities_points').selectAll('circle').data(populatedPlaces.features)
		var cityText = svg.append('g').attr('class', 'cities_label').selectAll('text').data(populatedPlaces.features);


		//set up scale and translate
		var b, s, t;
		projection.scale(1).translate([0,0]);
		var b = path.bounds(provinces);
		var s = .90 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
		var t = [(width - s * (b[1][0] + b[0][0])) /2, (height - s * (b[1][1] + b[0][1])) /2 ]; 
		projection.scale(s).translate(t);


		var admin0_poly = admin0_map.selectAll('path').data(country.features);
		admin0_poly.enter()
			.append('path')
			.attr('d', path)
			.attr('class', 'admin0_poly');


		//Admin1's:  provinces
		var admin1_poly = admin1_map.selectAll('path').data(provinces.features);
		admin1_poly.enter()
			.append('path')
			.attr('d', path)
			.attr('class', 'admin1_poly');

		var admin1_labels = admin1_map.selectAll('text').data(provinces.features);
		admin1_labels.enter()
			.append('text')
			.attr("class", "admin1_labels")
			// .attr("dx", ".35em")
			.attr("dy", ".35em")	
			.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
			.text(function(d) {
				console.log(d.properties.NAME_1)
				return d.properties.NAME_1
			});
		//exit
		// admin1_poly.exit().remove();


		//Admin2s:  regions
		admin2 = admin2_map.selectAll('path').data(regions.features);
		admin2.enter()
			.append('path')
			.attr('d', path)
			// .attr('border-color', '#ccc');
			.attr('id', geoID)
			.on("click", click)
		admin2.exit().remove();


		var  radius = d3.scale.linear().domain([0,1000]).range([0,110]);
		cityPoints.enter()
			.append('circle')
			.attr('cx', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0]})
			.attr('cy', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1]})
			.attr('r', function(d) {
			console.log(+d.properties.natscale)
			return (radius(+d.properties.natscale))})
			// .attr('fill', 'red');

		cityText.enter()
			.append('text')
			.attr('x', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0]})
			.attr('y', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1]})
			.attr('dx', 7)
			.attr('dy', 3)
			.text(function(d) {
				console.log(d.properties.name)
				return d.properties.name})	

		// cities.attr('fill', 'red')
		//exit
		cityPoints.exit().remove();


	});

})();

</script>	
	
</body>
</html>