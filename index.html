<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style>
		svg {
			border-style: solid;
			border-width: 1px;
			border-color: #ccc;
		}
		.admin0_poly{
			fill:  #ddd;
		}
		.admin1_boundary{
			fill: none;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-width: 1.5px;
			pointer-events: none;
		}
		.admin2_boundary{
			fill: none;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-width: 0.5px;
			pointer-events: none;
		}
		.admin2_poly {
		  fill: #ccc;
		}

		.admin2_poly :hover {
			fill: orange;
		}
		.admin1_text {
			fill: #777;
			fill-opacity: .75;
			font-size: 20px;
			font-weight: 300;
			text-anchor: middle;
		}
		.city_point {
			fill: red;
		}			
		.cities_text {
			font-family: Helvetica;
			font-weight: 300;
			font-size: 14px;
		}
		text {
		  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
		  pointer-events: none;
		}
	</style>
</head>
<body>

<div id="map"></div>

<script>
(function(){
	var height = 900;
	var width = 600;
	var projection = d3.geo.mercator();
	var path = d3.geo.path().projection(projection);
	var svg = d3.select("#map")
		.append("svg")
		.attr("width", width)
		.attr("height", height)

	d3.json('mdg-output.json', function(error, data){
		if (error) return console.error(error);

		//setting radius of city points
		var radius = d3.scale.linear().domain([0,1000]).range([0,110]);

		//set up scale and translate
		var b, s, t;
		projection.scale(1).translate([0,0]);
		var b = path.bounds(topojson.feature(data, data.objects.mdg_adm1));
		var s = .90 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
		var t = [(width - s * (b[1][0] + b[0][0])) /2, (height - s * (b[1][1] + b[0][1])) /2 ]; 
		projection.scale(s).translate(t);

		//objects
		svg.append("g")
				.attr("class", "admin0_poly")
			.selectAll("path")
				.data(topojson.feature(data, data.objects.mdg_adm0).features)
			.enter().append("path")
				.attr("d", path)
			.append("title")
				.text(function(d) { return d.properties.name });

		svg.append("g")
      .attr("class", "admin2_poly")
    .selectAll("path")
      .data(topojson.feature(data, data.objects.mdg_adm2).features)
    .enter().append("path")
      .attr("d", path)
    .append("title")
      .text(function(d) { 
      	console.log(d)
      	return d.properties.name; 
      });

		svg.append("g")
			.attr("class", "admin1_boundary")
			.append("path")
			.datum(topojson.mesh(data, data.objects.mdg_adm1, function(a,b) { 
				return a !== b; }))
			.attr("d", path);

		svg.append("g")
		.attr("class", "admin2_boundary")
			.append("path")
			.datum(topojson.mesh(data, data.objects.mdg_adm2, function(a,b) { 
				console.log(a)
				console.log(b)
				return a !== b; }))
			.attr("d", path);

		svg.append("g")
			.attr("class", "admin1_text")
			.selectAll("text")	
				.data(topojson.feature(data, data.objects.mdg_adm1).features)
			.enter().append("text")
			.attr("dy", ".35em")	
			.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
			.text(function(d) {
				return d.properties.NAME_1
			});

		svg.append("g")
				.attr("class", "city_point")
			.selectAll("circle")
	      .data(topojson.feature(data, data.objects.mdg_places).features)
      .enter().append("circle")
      // .attr("d", path)
      .attr('cx', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0]})
			.attr('cy', function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1]})
			.attr('r', function(d) {
				return (radius(+d.properties.natscale))
			})

		svg.append("g")
			.attr("class", "city_text")
			.selectAll("text")	
				.data(topojson.feature(data, data.objects.mdg_places).features)
			.enter().append("text")
			.attr("dy", ".35em")	
			.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
			.text(function(d) {
				return d.properties.name
			});

	});

})();

</script>	
	
</body>
</html>